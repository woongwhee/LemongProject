<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberMapper">

    <!-- MEMBER 테이블  -->
    <resultMap type="member" id="memberResultSet">
        <result column="USER_NO" property="userNo" />
        <result column="EMAIL" property="email" />
        <result column="USER_PWD" property="userPwd" />
        <result column="SOCIAL_TYPE" property="socialType" />
        <result column="ACCESS_TOKEN" property="accessToken" />
        <result column="STATUS" property="status" />
        <result column="USER_NAME" property="userName" />
    </resultMap>

    <!-- PROFILE 테이블  -->
    <resultMap type="Profile" id="profileResultSet">
        <result column="USER_NO" property="userNo"></result>
        <result column="NICK_NAME" property="nickName"></result>
        <result column="PHOTO_NO" property="photoNo"></result>
        <result column="PROFILE_COMMENT" property="profileComment"></result>
    </resultMap>

    <resultMap id="potoResultSet" type="Photo">
        <result column="PHOTO_NO" property="photoNo"></result>
        <result column="USER_NO" property="userNo"></result>
        <result column="ORIGIN_NAME" property="originName"></result>
        <result column="CHANGE_NAME" property="changeName"></result>
        <result column="FILE_PATH" property="filePath"></result>
    </resultMap>

    <!--  이메일 인증  -->
    <resultMap id="emailConfirmResultSet" type="EmailConfirm">
        <result column="CONFIRM_NO" property="confirmNo" />
        <result column="CODE" property="code" />
        <result column="EMAIL" property="email" />
        <result column="CONFIRM_AT" property="confirmDate" />
        <result column="STATUS" property="status" />
    </resultMap>



    <!-- 마이페이지 회원정보 List -->
    <select id="selectMyProList" resultMap="profileResultSet">
        SELECT *
        FROM USER_PROFILE
        WHERE USER_NO = 2
    </select>

    <!-- USER(회원가입)정보 가져오기  -->
    <select id="selectUser" resultMap="memberResultSet">
        SELECT *
        FROM MEMBER
        WHERE USER_NO = 2
    </select>

    <!-- USER정보(프로필)정보 => 닉네임 변경 -->
    <update id="updateUser" parameterType="string">
        UPDATE USER_PROFILE
        SET NICK_NAME = #{nickName}
        WHERE USER_NO = 2
    </update>

    <!-- USER정보(프로필)정보 => 자기소개 변경 -->
    <update id="updateComment" parameterType="string">
        UPDATE USER_PROFILE
        SET PROFILE_COMMENT = #{comment}
        WHERE USER_NO = 2
    </update>

    <insert id="insertUserProfile" parameterType="photo">
        INSERT INTO PHOTO(
            PHOTO_NO ,
            USER_NO ,
            ORIGIN_NAME ,
            CHANGE_NAME ,
            FILE_PATH
        )
        VALUES(
            SEQ_PHOTO.NEXTVAL , #{userNo} , #{originName} , #{changeName} , #{filePath}
        )
    </insert>

    <update id="updateUserProfile" parameterType="photo">
        UPDATE PHOTO
            SET ORIGIN_NAME = #{originName} ,
                CHANGE_NAME = #{changeName} ,
                FILE_PATH = #{filePath}
        WHERE USER_NO = 2
    </update>

    <update id="myupdatePwd" parameterType="string">
        UPDATE MEMBER
            SET USER_PWD = #{upPwd}
        WHERE USER_NO = 2
    </update>

    <select id="selectMyProfile" resultMap="potoResultSet">
        SELECT *
        FROM PHOTO
        WHERE USER_NO = 2
    </select>

    <update id="deleteUser" parameterType="int">
        UPDATE MEMBER
            SET STATUS = 0
        WHERE USER_NO = 3
    </update>


    <!--  로그인  -->
    <select id="loginMember" parameterType="Member" resultMap="memberResultSet">
        SELECT *
        FROM MEMBER
        WHERE EMAIL = #{email}
        AND STATUS = '1'
    </select>


    <!--  회원가입  -->
    <insert id="insertMember" parameterType="Map">
        INSERT ALL
        INTO MEMBER (USER_NO, EMAIL, USER_PWD, STATUS, USER_NAME)
            VALUES (SEQ_MEMBER.NEXTVAL, #{email}, #{userPwd}, DEFAULT, #{userName})
        INTO USER_PROFILE (USER_NO, NICK_NAME)
            VALUES (SEQ_MEMBER.CURRVAL, #{nickName})
        SELECT * FROM DUAL
    </insert>


    <!--  닉네임 중복 체크  -->
    <select id="checkNick" parameterType="Map" resultType="int">
        SELECT COUNT(*)
        FROM USER_PROFILE
        WHERE NICK_NAME = #{nickName}
    </select>


    <!-- 이메일 체크 -->
    <select id="checkEmail" parameterType="Map" resultType="int">
        SELECT COUNT(*) AS COUNT
        FROM EMAIL_CONFIRM
        WHERE EMAIL = #{email}
    </select>



    <!--  이메일 체크 삽입  -->
    <insert id="insertEmail" parameterType="Map">
        INSERT INTO EMAIL_CONFIRM (CONFIRM_NO, CODE, EMAIL, STATUS)
            VALUES(SEQ_CONFIRM.NEXTVAL, #{code}, #{email}, DEFAULT)
    </insert>

    <!-- 이메일 체크 삭제 -->
    <delete id="deleteEmail">

    </delete>


</mapper>